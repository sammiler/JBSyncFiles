<idea-plugin>
    <id>syncfiles</id>
    <name>SyncFiles</name>
    <version>3.3.0</version>
    <vendor email="sammilergood@gmail.com" url="https://cplusplusbug.org">sammiler</vendor>

    <!-- ↓↓↓ 使用纯英文描述以满足 Marketplace 要求 ↓↓↓ -->
    <description><![CDATA[
    <b>SyncFiles</b> is a lightweight plugin for IntelliJ IDEA (and compatible IDEs like CLion) designed to simplify syncing files and directories from GitHub repositories to your local project.<br/>
    Whether pulling code snippets, templates, or entire folders, SyncFiles streamlines the process with a user-friendly interface and customizable settings.<br/>
    <br/>
    <b>Key Features:</b>
    <ul>
        <li><b>GitHub File/Directory Sync</b>: Download individual files (raw.githubusercontent.com URLs) or entire directories (/tree/ links) from GitHub repositories.</li>
        <li><b>Custom Mappings</b>: Configure source URLs and target paths to sync files to specific locations in your project.</li>
        <li><b>Python Script Execution</b>: List and execute local Python (*.py) scripts from a specified directory within the tool window.</li>
        <li><b>Environment Variables</b>: Configure custom environment variables for executed Python scripts.</li>
        <li><b>Directory Monitoring</b>: Automatically monitors the configured Python script directory and refreshes the tool window button list upon changes.</li>
        <li><b>Project Auto-Refresh</b>: Automatically refreshes the IDE's virtual file system after sync or script execution to ensure changes are immediately visible.</li>
        <li><b>Tool Window Integration</b>: Initiate sync or script execution with a single click from the dedicated "SyncFiles" tool window (right sidebar).</li>
        <li><b>Multi-Instance Isolation</b>: Correctly handles multiple IDE windows (for different projects or multiple windows for the same project), ensuring isolated configuration, monitoring, and UI updates.</li>
    </ul>
    <br/>
    Configure the plugin via `File > Settings > Tools > SyncFiles Settings`.<br/>
    Requires IntelliJ IDEA 2024.1 or later.
    ]]></description>

    <!-- 更新日志 (可以保留中文，但英文更佳) -->
    <change-notes><![CDATA[
    <b>Version 3.2.0</b>
    <ul>
      <li>Fix: Resolved UI update confusion when opening multiple windows for the same project (by operating on window-specific UI components).</li>
      <li>Fix: Resolved configuration and directory monitoring conflicts when opening multiple IDE instances (different projects) using Project Scoping.</li>
      <li>Fix: Corrected potential `ArrayIndexOutOfBoundsException` (fromIndex > toIndex) when comparing identical files during directory merge.</li>
      <li>Improvement: Enhanced error handling and progress display during file/directory synchronization.</li>
      <li>Improvement: Used `backgroundPostStartupActivity` for startup initialization on a background thread to avoid blocking the UI.</li>
      <li>Improvement: Optimized settings UI experience and input validation.</li>
    </ul>
    <b>Version 3.1.0 and earlier</b>
    <ul>
      <li>Initial release with GitHub file and directory sync support.</li>
      <li>Added local Python script execution and directory monitoring features.</li>
      <li>Fixed configuration initialization and shortcut-related issues in earlier versions.</li>
    </ul>
    ]]></change-notes>

    <!-- 兼容性 -->
    <idea-version since-build="241" until-build="251.*"/>

    <!-- 核心平台依赖 -->
    <depends>com.intellij.modules.platform</depends>

    <!-- 扩展点实现 -->
    <extensions defaultExtensionNs="com.intellij">
        <projectService serviceImplementation="com.example.syncfiles.ProjectDirectoryWatcherService"/>
        <backgroundPostStartupActivity implementation="com.example.syncfiles.WatcherInitializerActivity"/>
        <toolWindow id="SyncFiles" secondary="true" anchor="right" icon="/icons/syncToolWindow.svg"
                    factoryClass="com.example.syncfiles.SyncFilesToolWindowFactory"/>
        <projectConfigurable id="com.example.syncfiles.SyncFilesSettings"
                             displayName="SyncFiles Settings"
        instance="com.example.syncfiles.SyncFilesSettingsConfigurable"/>
    </extensions>

    <!-- 可选：定义一个手动触发同步的 Action -->
    <actions>
        <action id="SyncFiles.ManualSync" class="com.example.syncfiles.SyncAction" text="Sync GitHub Files Now"
                description="Manually triggers file synchronization from GitHub based on settings."
                icon="AllIcons.Actions.CheckOut">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>

</idea-plugin>